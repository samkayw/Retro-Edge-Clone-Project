<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar</title>
        <!-- general style sheet -->
    <link rel="stylesheet" href="style.css">

        <!-- calendar style sheet -->
    <link rel="stylesheet" href="calendar.css">

    <!-- navigation style sheet -->
     <link rel="stylesheet" href="navigation.css">

    <!-- hero style sheet -->
      <link rel="stylesheet" href="hero.css">

    <!-- section style sheet -->
     <link rel="stylesheet" href="sections.css">

     <!-- footer style sheet -->
      <link rel="stylesheet" href="footer.css">

    <!-- Google Font import for Chakra Petch -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
    </style>

</head>
<body>
     <!-- navigation bar -->
    <nav class="desktop-nav">
        <div id="hamburgerMenu" aria-label="Menu Icon" tabindex="0">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span> 
        </div>

        <!-- lets me control with js -->
        <div class="navLinks"> 
            <a  href="index.html" tabindex="1">Home</a>
            <a  href="about.html" tabindex="2" >About</a>
            <a  href="#" tabindex="3" id="selected">Calendar</a>
        </div>
        
    </nav>
<!-- <img src="./image assets/PokeBall.png" alt=""> -->
 <!-- <img src="./image assets/SmashBrothersIcon.png" alt=""> -->
  <!-- <img src="./image assets/LogoIcon.png" alt=""> -->
   <!-- <img src="./image assets/GuiltyGearIcon.png" alt=""> -->

    





<!-- SURFACE -->
<section>
    <p>Google Calendar API Quickstart</p>

    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
    <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>
    <h1>MONTHLY CALENDAR</h1>
     <header id="calendar-header"></header>
     <div id="calendar-grid" class="calendar-grid"></div>

     <p class="tooltip">American Dog
      <span class="tooltiptext">Erpy Walker</span>
     </p>
</section>
<!-- SURFACE -->







     <footer id="footer-column">

        <!-- left side -->
        <div id="footer-left">
            <div>
                <h3>Contact Us</h3>
                <p>707-419-6171</p>
                <a href="#">Email Us</a>
                <p>Mailing Address:</p>
                <p>RetroEdge Games</p>
                <p>2085 Solano Ave</p>
                <p>Vallejo, CA, 94590</p>
            </div>
        </div>
        <br>

        <!-- right side -->
        <div id="footer-right">
            <div>
                <h3>Store Hours</h3>
                <p>Mon CLOSED</p>
                <p>Tue CLOSED</p>
                <p>Wed: 2p-10p</p>
                <p>Thu: 2p-10p</p>
                <p>Fri: 2p-10p</p>
                <p>Sat: 2p-10p</p>
                <p>Sun: 2p-10p</p>
            </div>
        </div>

    </footer>

    <script type="text/javascript">
      /* exported gapiLoaded */
      /* exported gisLoaded */
      /* exported handleAuthClick */
      /* exported handleSignoutClick */

      // TODO(developer): Set to client ID and API key from the Developer Console
      const CLIENT_ID = '300093958729-8g1fr9o7catq7jtgh26gd6293d0n6qfh.apps.googleusercontent.com';
      const API_KEY = 'AIzaSyACeAr4hZMJ9axLPEMzLPZgQr8XkYAZl1k';

      // Discovery doc URL for APIs used by the quickstart
      const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';

      let tokenClient;
      let gapiInited = false;
      let gisInited = false;

      document.getElementById('authorize_button').style.visibility = 'hidden';
      document.getElementById('signout_button').style.visibility = 'hidden';

      /**
       * Callback after api.js is loaded.
       */
      function gapiLoaded() {
        gapi.load('client', initializeGapiClient);
      }

      /**
       * Callback after the API client is loaded. Loads the
       * discovery doc to initialize the API.
       */
      async function initializeGapiClient() {
        await gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: [DISCOVERY_DOC],
        });
        gapiInited = true;
        maybeEnableButtons();
      }

      /**
       * Callback after Google Identity Services are loaded.
       */
      function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: CLIENT_ID,
          scope: SCOPES,
          callback: '', // defined later
        });
        gisInited = true;
        maybeEnableButtons();
      }

      /**
       * Enables user interaction after all libraries are loaded.
       */
      function maybeEnableButtons() {
        if (gapiInited && gisInited) {
          document.getElementById('authorize_button').style.visibility = 'visible';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
// SIGN IN 
      function handleAuthClick() {
        tokenClient.callback = async (resp) => {
          if (resp.error !== undefined) {
            throw (resp);
          }
          document.getElementById('signout_button').style.visibility = 'visible';
          document.getElementById('authorize_button').innerText = 'Refresh';
          await listUpcomingEvents();
        };

        if (gapi.client.getToken() === null) {
          // Prompt the user to select a Google Account and ask for consent to share their data
          // when establishing a new session.
          tokenClient.requestAccessToken({prompt: 'consent'});
        } else {
          // Skip display of account chooser and consent dialog for an existing session.
          tokenClient.requestAccessToken({prompt: ''});
        }
      }
// SIGN IN
      /**
       *  Sign out the user upon button click.
       */
//SIGN OUT
      function handleSignoutClick() {
        const token = gapi.client.getToken();
        if (token !== null) {
          google.accounts.oauth2.revoke(token.access_token);
          gapi.client.setToken('');
          document.getElementById('content').innerText = '';
          document.getElementById('authorize_button').innerText = 'Authorize';
          document.getElementById('signout_button').style.visibility = 'hidden';
        }
      }
//SIGN OUT
      /**
       * Print the summary and start datetime/date of the next ten events in
       * the authorized user's calendar. If no events are found an
       * appropriate message is printed.
       */

      //async function
      async function listUpcomingEvents() {
        //create a response variable to be packed later
        let response;
        //try to get a list of these items
        try {
// API Calls List
          const request = {
            'calendarId': '3cae1ba52ac23bca99893a1b81869bf4fd06aae62a79f167b7ac76510d26c045@group.calendar.google.com',
            'timeMin': (new Date()).toISOString(),
            'showDeleted': false,
            'singleEvents': true,
            'maxResults': 100,
            'orderBy': 'startTime',
          };
// API Calls List
        // once thats done, put it in here
          response = await gapi.client.calendar.events.list(request);
          
        //if something doesn't work, throw this error
        } catch (err) {
          document.getElementById('content').innerText = err.message;
          return;
        }

        //drill down into response just to get the items and save it into the events
        const events = response.result.items;
        const now = new Date();
        renderCalendar(events, now.getMonth(), now.getFullYear());

        //if there's no events show it here
        if (!events || events.length == 0) {
          document.getElementById('content').innerText = 'No events found.';
          return;
        }
      } 
        console.clear()
        



//MY CALENDAR VARIABLES
function renderCalendar(events, month, year) {
  const header = document.getElementById('calendar-header');
  const weekdayNames = [
    'SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'
  ];

  const weekdayLength = weekdayNames.length;

  const monthNames = [
    'JANUARY','FEBRUARY','MARCH','APRIL','MAY','JUNE',
    'JULY','AUGUST','SEPTEMBER','OCTOBER','NOVEMBER','DECEMBER'
  ];

  header.innerText = `${monthNames[month]} ${year}`;

  const grid = document.getElementById('calendar-grid');
  grid.innerHTML = '';

  
  //insert days of the week headers
  for (i = 0; weekdayLength > i; i++) {
    const weekName = document.createElement('div')
    weekName.className = 'calendar-row-header';
    weekName.innerHTML = `<div>${weekdayNames[i]}</div>`;
    grid.append(weekName);
  };


  // 1) Compute first weekday & month lengths
  const firstDay   = new Date(year, month, 1).getDay();       // 0=Sun…6=Sat on this day is Tuesday
  const daysInMonth= new Date(year, month+1, 0).getDate();    // e.g. 31 days of the current month and +1 because we init from index 0
  const daysInPrev = new Date(year, month,   0).getDate();    // e.g. 30 for June 

  // 2) Fill in tail of previous month (so “1” of this month lines up)
  //make i = to first day, which is 2 because it starts on tuesday and subtract 1 because >=. As long as i (1) is greater than or equal to 0 then create a variable called d which is days in prev - 1 = 29. and then make a thing called cell which is an empty div. Take the cell and give it 2 classes, calendar-day and other-month. Change the html to include the day number and then add it to the grid. This happens just two times 
  for (let i = firstDay - 1; i >= 0; i--) {
    const d = daysInPrev - i;
    const cell = document.createElement('div');
    cell.className = 'calendar-day other-month';
    // image test
    cell.innerHTML = `<div class="day-number">${d}</div>`;
    grid.appendChild(cell);
  }

  // 3) Fill in **this** month, with events
  // if date is 1 and it is less than or equal to days in month which is 31 we will create a cell which is an empy div and give it a class of this month calendar-day. And then we give an innerhtml of day number and insert the date which will serve as the day number. And then create something called an evlist and set that to an empty div then give it a class called events. And then we will make a datestring called dateStr and we'll slice it down to a YYYY-MM-DD format we then take the given events param and filter it down with an ev token and if the start.dateTime matches the dateStr we will create an item that is an empty div, give that item a calss of event, make the inner html the event title and append it into the event list for that day and we'll increment until we're done. After we've done that we'll put the evlist in the 


    const pokeIcon = './image assets/PokeBall.png'
    const smashIcon = './image assets/SmashBrothersIcon.png'
    const logoIcon = './image assets/LogoIcon.png'
    const ggIcon = '/image assets/GuiltyGearIcon.png'
    const sfIcon = '/image assets/SFLogo.png'

  for (let date = 1; date <= daysInMonth; date++) {
    const cell = document.createElement('div');
    cell.className = 'calendar-day this-month';

    // a) Day number
    cell.innerHTML = `<div class="day-number">${date} </div>`;

    // b) Event container
    const evList = document.createElement('div');
    evList.className = 'events';



    // c) Attach any events that match this date
    const dateStr = new Date(year, month, date).toISOString().slice(0,10); // “YYYY-MM-DD”
    events.filter(ev => (ev.start.dateTime||ev.start.date).slice(0,10) === dateStr).forEach(ev => {
        
        const item = document.createElement('div');
        const title = ev.summary;
        const icon = document.createElement('img');

        let eventStartTime;
        let eventEndTime;

        if (ev.start.dateTime) {
            const dst = new Date(ev.start.dateTime);
            eventStartTime = dst.toLocaleTimeString(["en-us"], {hour:'numeric', minute:'2-digit'});

            const dnt = new Date(ev.end.dateTime);
            eventEndTime = dnt.toLocaleTimeString(["en-us"], {hour:'numeric', minute:'2-digit'});

            // console.log(ev.end.dateTime)
            // console.log(ev.start.dateTime)
        } else {
          eventStartTime = 'Inquire In Store'
          eventEndTime = ''
        }


        //checks the event name and places the corresponding icon
        if ( title.includes('Smash') ){
            icon.src = smashIcon;
            
            
        } else if ( title.includes('Pokemon')) {
          icon.src = pokeIcon
          
          
        } else if (title.includes('Guilty')){
          icon.src = ggIcon;
          
          
        } else if (title.includes('Street')) {
          icon.src = sfIcon
          
          
        } else {
          icon.src = logoIcon
          
          
        };
        
        toolTipText = title;
        // eventTime.className = 'start-time'

        // const tooltipMessage = createElement('span')
        // item.innerText = ev.summary;
        icon.className = 'calendar-icon';
        item.appendChild(icon);
        item.className = 'tooltip event';

        //create the tool tip
        //give it our class
        //make the words be the title
        //add it to item as a chile so that it will activate on hover
        const tip = document.createElement('span');
        tip.className = 'tooltiptext';
        tip.textContent = `${title}\nFrom: ${eventStartTime}-${eventEndTime}`;
        item.appendChild(tip);
        evList.appendChild(item);
        

    
      });

    cell.appendChild(evList);
    grid.appendChild(cell);
  }


  // 4) Fill in head of next month so last week is full
  const totalCells = firstDay + daysInMonth;
  const need = (7 - (totalCells % 7)) % 7;  
  for (let d = 1; d <= need; d++) {
    const cell = document.createElement('div');
    cell.className = 'calendar-day other-month';
    cell.innerHTML = `<div class="day-number">${d}</div>`;
    grid.appendChild(cell);
  }
}

    </script>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>


        <script src="script.js"></script>
        <script src="calendar.js"></script>

</body>
</html>